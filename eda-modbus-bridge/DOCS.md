# Home Assistant add-on: eda-modbus-bridge

This document only describes how to configure the add-on itself - for more information about the application, please 
see the [eda-modbus-bridge README](https://github.com/Jalle19/eda-modbus-bridge/blob/master/README.md).

## Configuration

The most important settings are commented below:

```yaml
modbus:
  # The RS-485 device to use. It's recommended to use a non-changing name like /dev/serial/by-id/usb-FTDI_FT232R_USB_UART_AG0KBDA8-if00-port0
  device: /dev/ttyUSB0
  slave: 1
mqtt:
  # The address and port to your MQTT broker. Omit to not use MQTT support (limited functionality)
  server: '''
  port: 1883
  username: ''
  password: ''
  publish_interval: 10
http:
  # The HTTP API is disabled by default. If enabled, you'll probably want to expose the port outside the container 
  # in the "Network" section
  enabled: false
  listen_address: 0.0.0.0
  listen_port: 8080
```

## Usage

Nominal add-on startup output looks like this:

```
[s6-init] making user provided files available at /var/run/s6/etc...exited 0.
[s6-init] ensuring user provided files have correct perms...exited 0.
[fix-attrs.d] applying ownership & permissions fixes...
[fix-attrs.d] done.
[cont-init.d] executing container initialization scripts...
[cont-init.d] done.
[services.d] starting services
[services.d] done.
[21:15:06] INFO: Init config
[21:15:07] INFO: ---------------------------------------------------
[21:15:07] INFO: Modbus device: /dev/serial/by-id/usb-FTDI_FT232R_USB_UART_AG0KBDA8-if00-port0
[21:15:07] INFO: Modbus slave: 1
[21:15:07] INFO: HTTP listening on: 0.0.0.0:8080
[21:15:07] INFO: MQTT broker: 10.110.1.3:1883
[21:15:07] INFO: MQTT: anonymous login
[21:15:07] INFO: MQTT publish interval: 10
[21:15:07] INFO: ---------------------------------------------------
Opening serial connection to /dev/serial/by-id/usb-FTDI_FT232R_USB_UART_AG0KBDA8-if00-port0, slave ID 1
Connecting to MQTT broker at mqtt://10.110.1.3:1883
Listening on http://0.0.0.0:8080
MQTT scheduler started, will publish readings every 10 seconds
Subscribing to topic(s) eda/mode/+/set
Subscribing to topic(s) eda/settings/+/set
Publishing Home Assistant auto-discovery configuration for sensor "freshAirTemperature"...
Publishing Home Assistant auto-discovery configuration for sensor "supplyAirTemperature"...
Publishing Home Assistant auto-discovery configuration for sensor "supplyAirTemperatureAfterHeatRecovery"...
Publishing Home Assistant auto-discovery configuration for sensor "exhaustAirTemperature"...
Publishing Home Assistant auto-discovery configuration for sensor "wasteAirTemperature"...
Publishing Home Assistant auto-discovery configuration for sensor "exhaustAirHumidity"...
Publishing Home Assistant auto-discovery configuration for sensor "mean48HourExhaustHumidity"...
Publishing Home Assistant auto-discovery configuration for sensor "heatRecoverySupplySide"...
Publishing Home Assistant auto-discovery configuration for sensor "heatRecoveryExhaustSide"...
Publishing Home Assistant auto-discovery configuration for sensor "cascadeSp"...
Publishing Home Assistant auto-discovery configuration for sensor "cascadeP"...
Publishing Home Assistant auto-discovery configuration for sensor "cascadeI"...
Publishing Home Assistant auto-discovery configuration for sensor "overPressureTimeLeft"...
Publishing Home Assistant auto-discovery configuration for sensor "ventilationLevelTarget"...
Publishing Home Assistant auto-discovery configuration for sensor "ventilationLevelActual"...
Publishing Home Assistant auto-discovery configuration for number "overPressureDelay"...
Publishing Home Assistant auto-discovery configuration for number "awayVentilationLevel"...
Publishing Home Assistant auto-discovery configuration for number "awayTemperatureReduction"...
Publishing Home Assistant auto-discovery configuration for number "longAwayVentilationLevel"...
Publishing Home Assistant auto-discovery configuration for number "longAwayTemperatureReduction"...
Publishing Home Assistant auto-discovery configuration for number "temperatureTarget"...
Publishing Home Assistant auto-discovery configuration for switch "away"...
Publishing Home Assistant auto-discovery configuration for switch "longAway"...
Publishing Home Assistant auto-discovery configuration for switch "overPressure"...
Publishing Home Assistant auto-discovery configuration for switch "maxHeating"...
Publishing Home Assistant auto-discovery configuration for switch "maxCooling"...
Publishing Home Assistant auto-discovery configuration for switch "manualBoost"...
Publishing Home Assistant auto-discovery configuration for switch "summerNightCooling"...
Finished configuration Home Assistant MQTT discovery
```
