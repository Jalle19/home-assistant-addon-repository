# Home Assistant add-on: eda-modbus-bridge

This document only describes how to configure the add-on itself - for more information about the application, please
see the [eda-modbus-bridge README](https://github.com/Jalle19/eda-modbus-bridge/blob/master/README.md).

## Configuration

The most important settings are commented below:

```yaml
modbus:
  # The RS-485 device to use. It's recommended to use a non-changing name like /dev/serial/by-id/usb-FTDI_FT232R_USB_UART_AG0KBDA8-if00-port0
  device: /dev/ttyUSB0
  slave: 1
mqtt:
  # If MQTT service is available the addon specific MQTT configuration will be ignored, except publish_interval
  host: ''
  ssl: false
  port: 1883
  username: ''
  password: ''
  publish_interval: 10
http:
  # The HTTP API is disabled by default. If enabled, you'll probably want to expose the port outside the container
  # in the "Network" section
  enabled: false
  listen_address: 0.0.0.0
  listen_port: 8080
```

## Usage

Nominal add-on startup output looks like this:

```
[s6-init] making user provided files available at /var/run/s6/etc...exited 0.
[s6-init] ensuring user provided files have correct perms...exited 0.
[fix-attrs.d] applying ownership & permissions fixes...
[fix-attrs.d] done.
[cont-init.d] executing container initialization scripts...
[cont-init.d] done.
[services.d] starting services
[services.d] done.
[12:43:27] INFO: MQTT service found, using service config
Opening serial connection to /dev/ttyUSB0, slave ID 1
Connecting to MQTT broker at mqtt://core-mosquitto:1883
Using MQTT broker authentication
MQTT scheduler started, will publish readings every 10 seconds
Subscribing to topic(s) eda/mode/+/set
Subscribing to topic(s) eda/settings/+/set
Publishing Home Assistant auto-discovery configuration for sensor "freshAirTemperature"...
Publishing Home Assistant auto-discovery configuration for sensor "supplyAirTemperature"...
Publishing Home Assistant auto-discovery configuration for sensor "supplyAirTemperatureAfterHeatRecovery"...
Publishing Home Assistant auto-discovery configuration for sensor "exhaustAirTemperature"...
Publishing Home Assistant auto-discovery configuration for sensor "wasteAirTemperature"...
Publishing Home Assistant auto-discovery configuration for sensor "exhaustAirHumidity"...
Publishing Home Assistant auto-discovery configuration for sensor "mean48HourExhaustHumidity"...
Publishing Home Assistant auto-discovery configuration for sensor "heatRecoverySupplySide"...
Publishing Home Assistant auto-discovery configuration for sensor "heatRecoveryExhaustSide"...
Publishing Home Assistant auto-discovery configuration for sensor "cascadeSp"...
Publishing Home Assistant auto-discovery configuration for sensor "cascadeP"...
Publishing Home Assistant auto-discovery configuration for sensor "cascadeI"...
Publishing Home Assistant auto-discovery configuration for sensor "overPressureTimeLeft"...
Publishing Home Assistant auto-discovery configuration for sensor "ventilationLevelTarget"...
Publishing Home Assistant auto-discovery configuration for sensor "ventilationLevelActual"...
Publishing Home Assistant auto-discovery configuration for number "overPressureDelay"...
Publishing Home Assistant auto-discovery configuration for number "awayVentilationLevel"...
Publishing Home Assistant auto-discovery configuration for number "awayTemperatureReduction"...
Publishing Home Assistant auto-discovery configuration for number "longAwayVentilationLevel"...
Publishing Home Assistant auto-discovery configuration for number "longAwayTemperatureReduction"...
Publishing Home Assistant auto-discovery configuration for number "temperatureTarget"...
Publishing Home Assistant auto-discovery configuration for switch "away"...
Publishing Home Assistant auto-discovery configuration for switch "longAway"...
Publishing Home Assistant auto-discovery configuration for switch "overPressure"...
Publishing Home Assistant auto-discovery configuration for switch "maxHeating"...
Publishing Home Assistant auto-discovery configuration for switch "maxCooling"...
Publishing Home Assistant auto-discovery configuration for switch "manualBoost"...
Publishing Home Assistant auto-discovery configuration for switch "summerNightCooling"...
Publishing Home Assistant auto-discovery configuration for binary_sensor "TE5InletAfterHeatExchangerCold"...
Publishing Home Assistant auto-discovery configuration for binary_sensor "TE10InletAfterHeaterCold"...
Publishing Home Assistant auto-discovery configuration for binary_sensor "TE10InletAfterHeaterHot"...
Publishing Home Assistant auto-discovery configuration for binary_sensor "TE20RoomHot"...
Publishing Home Assistant auto-discovery configuration for binary_sensor "TE30OutletCold"...
Publishing Home Assistant auto-discovery configuration for binary_sensor "TE30OutletHot"...
Publishing Home Assistant auto-discovery configuration for binary_sensor "HPFault"...
Publishing Home Assistant auto-discovery configuration for binary_sensor "HeaterFault"...
Publishing Home Assistant auto-discovery configuration for binary_sensor "ReturnWaterCold"...
Publishing Home Assistant auto-discovery configuration for binary_sensor "LTOFault"...
Publishing Home Assistant auto-discovery configuration for binary_sensor "CoolingFault"...
Publishing Home Assistant auto-discovery configuration for binary_sensor "EmergencyStop"...
Publishing Home Assistant auto-discovery configuration for binary_sensor "FireRisk"...
Publishing Home Assistant auto-discovery configuration for binary_sensor "ServiceReminder"...
Publishing Home Assistant auto-discovery configuration for binary_sensor "HeaterPressureSwitch"...
Publishing Home Assistant auto-discovery configuration for binary_sensor "InletFilterDirty"...
Publishing Home Assistant auto-discovery configuration for binary_sensor "OutletFilterDirty"...
Publishing Home Assistant auto-discovery configuration for binary_sensor "InletFanPressureAbnomaly"...
Publishing Home Assistant auto-discovery configuration for binary_sensor "OutletFanPressureAbnomaly"...
Finished configuration Home Assistant MQTT discovery
```

## Alarms

The MQTT auto-discovery feature creates a binary sensor for each alarm the device supports. There are quite a few of 
these, and in many cases it's enough to know that _any_ alarm is on (the exact alarm can then be checked manually). To 
group together all alarms into a single "master alarm" entity you can use the following snippet (add to `groups.yaml`):

```yaml
eda_master_alarm:
    name: Master alarm
    icon: 'mdi:alarm-bell'
    entities:
      - binary_sensor.eda_returnwatercold
      - binary_sensor.eda_emergencystop
      - binary_sensor.eda_firerisk
      - binary_sensor.eda_servicereminder
      - binary_sensor.eda_te5supplyairafterhrcold
      - binary_sensor.eda_te10supplyairafterheatercold
      - binary_sensor.eda_te10supplyairafterheaterhot
      - binary_sensor.eda_te20roomtemphot
      - binary_sensor.eda_te30extractaircold
      - binary_sensor.eda_te30extractairhot
      - binary_sensor.eda_hperror
      - binary_sensor.eda_eherror
      - binary_sensor.eda_coolingerror
      - binary_sensor.eda_ehpda
      - binary_sensor.eda_supplyfilterdirty
      - binary_sensor.eda_extractfilterdirty
      - binary_sensor.eda_supplyfanpressureerror
      - binary_sensor.eda_extractfanpressureerror
```